<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Trading Simulator - Complete Integration</title>

    <!-- Game Data -->
    <script src="data/january.js"></script>
    <script src="data/february.js"></script>
    <script src="data/march.js"></script>
    <script src="data/april.js"></script>

    <!-- CSS Stylesheets -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/panels.css">
    <link rel="stylesheet" href="css/markets-widget.css">
    <link rel="stylesheet" href="css/trade-panel.css">
    <link rel="stylesheet" href="css/positions-widget.css">

    <!-- Initialize Application -->
    <script type="module" src="js/init.js"></script>
</head>
<body>
    <!-- Fixed Header Bar -->
    <div class="header-bar">
        <div class="header-metric">
            <div class="header-metric-label">Month</div>
            <div class="header-metric-value" id="headerMonth">JAN (1/12)</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">Practice Funds</div>
            <div class="header-metric-value" id="headerFunds">$200,000</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">LOC Used</div>
            <div class="header-metric-value" id="headerLOC">$0 / $200K</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">Buying Power</div>
            <div class="header-metric-value" id="headerBuyingPower">$400,000</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">LOC Interest (Next)</div>
            <div class="header-metric-value" id="headerLOCInterest">$0</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">LME (0)</div>
            <div class="header-metric-value" id="headerLMESpot">$8,960</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">LME (3M)</div>
            <div class="header-metric-value" id="headerLME3M">$9,210</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">COMEX (0)</div>
            <div class="header-metric-value" id="headerCOMEXSpot">$9,344</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">COMEX (3M)</div>
            <div class="header-metric-value" id="headerCOMEX3M">$9,594</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">Physical MT</div>
            <div class="header-metric-value" id="headerPhysicalMT">0</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">Futures MT</div>
            <div class="header-metric-value" id="headerFuturesMT">0</div>
        </div>
        <div class="header-metric">
            <div class="header-metric-label">Total P&L</div>
            <div class="header-metric-value" id="headerPL">$0</div>
        </div>
        <button class="next-turn-btn" id="nextTurnBtn">NEXT TURN ‚ñ∂</button>
        <button class="theme-toggle" id="themeToggleBtn">‚òÄÔ∏è Light Mode</button>
    </div>

    <div class="container">
        <!-- Collapsible Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-toggle" id="sidebarToggle">‚óÄ</div>
            <div class="sidebar-content">
                <h3>Widgets</h3>
                <ul class="widget-list">
                    <li class="widget-item" draggable="true" data-widget="Markets">Markets</li>
                    <li class="widget-item" draggable="true" data-widget="Positions">Positions</li>
                    <li class="widget-item" draggable="true" data-widget="Calendar">Calendar</li>
                    <li class="widget-item" draggable="true" data-widget="Futures">Futures</li>
                    <li class="widget-item" draggable="true" data-widget="News">News</li>
                    <li class="widget-item" draggable="true" data-widget="Active Map">Active Map</li>
                </ul>
            </div>
        </div>

        <!-- Workspace (3-Panel Area) -->
        <div class="workspace" id="workspace">
            <!-- Panel A -->
            <div class="panel-zone empty" id="panelA" data-panel="A"></div>

            <!-- Divider A-B -->
            <div class="panel-divider" data-divider="A-B" style="display: none;"></div>

            <!-- Panel B (Markets Pre-loaded) -->
            <div class="panel-zone" id="panelB" data-panel="B">
                <div class="panel-container">
                    <div class="panel-header">
                        <div class="panel-tab active" data-widget="Markets">
                            <span class="panel-tab-name">Markets</span>
                            <span class="close-btn" data-close-panel="B" data-close-widget="Markets">√ó</span>
                        </div>
                    </div>
                    <div class="panel-content">
                        <div class="widget-content active" data-widget="Markets">
                            <div class="markets-widget-content">
                                <!-- SUPPLIERS TABLE -->
                                <div class="section-title">üîµ Suppliers - Buy Copper</div>
                                <table class="markets-table">
                                    <thead>
                                        <tr>
                                            <th>SELLER</th>
                                            <th>AVAILABLE</th>
                                            <th>PRICING BASIS</th>
                                            <th>PREMIUM</th>
                                            <th>ACTIONS</th>
                                        </tr>
                                    </thead>
                                    <tbody id="suppliersTableBody"></tbody>
                                </table>

                                <!-- BUYERS TABLE -->
                                <div class="section-title">üü¢ Buyers - Sell Copper</div>
                                <table class="markets-table">
                                    <thead>
                                        <tr>
                                            <th>BUYER</th>
                                            <th>DEMAND</th>
                                            <th>PORT</th>
                                            <th>EXCHANGE</th>
                                            <th>QP</th>
                                            <th>PREMIUM</th>
                                            <th>ACTIONS</th>
                                        </tr>
                                    </thead>
                                    <tbody id="buyersTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="widget-content" data-widget="Futures" style="display: none;">
                            <div class="futures-widget-content">

                                <!-- Summary Stats -->
                                <div class="match-stats" style="margin-bottom: 20px;">
                                    <div class="match-stat">
                                        <div class="match-stat-label">Unrealized P&L</div>
                                        <div class="match-stat-value" id="futuresUnrealizedPL">$0</div>
                                    </div>
                                    <div class="match-stat">
                                        <div class="match-stat-label">Margin Used</div>
                                        <div class="match-stat-value" id="futuresMarginUsed">$0 / $100K</div>
                                    </div>
                                </div>

                                <!-- Available Contracts -->
                                <div class="section-title">üìä Available Contracts</div>
                                <div id="futuresAvailableTable"></div>

                                <!-- Open Positions -->
                                <div class="section-title" style="margin-top: 30px;">üìà Open Positions</div>
                                <div id="futuresPositionsTable"></div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Divider B-C -->
            <div class="panel-divider" data-divider="B-C" style="display: none;"></div>

            <!-- Panel C -->
            <div class="panel-zone empty" id="panelC" data-panel="C"></div>
        </div>
    </div>

    <!-- Drag Preview Tooltip -->
    <div class="drag-preview" id="dragPreview"></div>

    <!-- Buy Panel (500x500, Draggable, No Overlay) -->
    <div class="trade-panel" id="buyPanel">
        <div class="trade-panel-header" id="buyPanelHeader">
            <span class="trade-panel-title">Buy Copper</span>
            <button class="trade-panel-close" id="buyPanelClose" onclick="window.TradePanel.close()">√ó</button>
        </div>
        <div class="trade-panel-body">
            <div class="info-box">
                <div class="info-row">
                    <span class="info-label">SUPPLIER</span>
                    <span class="info-value" id="buySupplier">CALLAO</span>
                </div>
                <div class="info-row">
                    <span class="info-label">PORT</span>
                    <span class="info-value" id="buyPort">Callao, Peru</span>
                </div>
                <div class="info-row">
                    <span class="info-label">PRICING BASIS</span>
                    <span class="info-value" id="buyBasis">LME M+1</span>
                </div>
                <div class="info-row">
                    <span class="info-label">SUPPLIER PREMIUM</span>
                    <span class="info-value" id="buyPremium">+$15/MT</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Tonnage (MT)</label>
                <input type="number" class="form-input" id="buyTonnage" min="5" value="5">
                <div style="font-size: 11px; color: #888; margin-top: 6px;" id="buyRange">Range: 5 - 17 MT</div>
            </div>

            <div class="form-group" id="buyExchangeGroup">
                <label class="form-label">Exchange</label>
                <div class="radio-group">
                    <label class="radio-option selected" id="buyLMEOption" onclick="window.TradePanel.selectExchange('LME', event)">
                        <input type="radio" name="exchange" value="LME" checked>
                        <div class="radio-option-label">LME M+1</div>
                    </label>
                    <label class="radio-option" id="buyCOMEXOption" onclick="window.TradePanel.selectExchange('COMEX', event)">
                        <input type="radio" name="exchange" value="COMEX">
                        <div class="radio-option-label">COMEX M+1</div>
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Destination Port</label>
                <select class="form-select" id="buyDestination">
                    <option value="">Select destination...</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Shipping Terms</label>
                <div class="radio-group">
                    <label class="radio-option selected" id="fobOption" onclick="window.TradePanel.selectShipping('FOB')">
                        <input type="radio" name="shippingTerms" value="FOB" checked>
                        <div class="radio-option-label">FOB</div>
                        <div class="radio-option-value" id="fobPriceDisplay">$9039/MT</div>
                    </label>
                    <label class="radio-option" id="cifOption" onclick="window.TradePanel.selectShipping('CIF')">
                        <input type="radio" name="shippingTerms" value="CIF">
                        <div class="radio-option-label">CIF</div>
                        <div class="radio-option-value" id="cifPriceDisplay">$9070/MT</div>
                    </label>
                </div>
            </div>

            <div class="calc-section">
                <div class="calc-title">Cost Breakdown (Estimated)</div>
                <div class="calc-row">
                    <span class="calc-label">Base Price (Spot):</span>
                    <span class="calc-value" id="buyBasePrice">$8960/MT</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">Supplier Premium:</span>
                    <span class="calc-value" id="buySupplierPremium">+$15/MT</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">Freight Cost:</span>
                    <span class="calc-value" id="buyFreight">$64/MT (FOB)</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">Price/MT:</span>
                    <span class="calc-value" id="buyPricePerMT">$9039/MT</span>
                </div>
                <div class="calc-row total-row">
                    <span class="calc-label">Total Cost:</span>
                    <span class="calc-value" id="buyTotalCost">$45,195</span>
                </div>
                <div class="warning-box">
                    ‚ö†Ô∏è <span id="buyQPWarning">QP settlement in March based on February average</span>
                </div>
            </div>

            <button class="execute-btn" id="executeBuyBtn" onclick="window.TradePanel.executeBuy()">PURCHASE COPPER</button>
        </div>
    </div>

    <!-- Sell Panel (500x500, Draggable, No Overlay) -->
    <div class="trade-panel" id="sellPanel">
        <div class="trade-panel-header sell" id="sellPanelHeader">
            <span class="trade-panel-title">Sell Copper</span>
            <button class="trade-panel-close" id="sellPanelClose" onclick="window.TradePanel.close()">√ó</button>
        </div>
        <div class="trade-panel-body">
            <div class="info-box">
                <div class="info-row">
                    <span class="info-label">BUYER</span>
                    <span class="info-value" id="sellBuyer">AMERICAS</span>
                </div>
                <div class="info-row">
                    <span class="info-label">DESTINATION</span>
                    <span class="info-value" id="sellDest">New Orleans, USA</span>
                </div>
                <div class="info-row">
                    <span class="info-label">EXCHANGE</span>
                    <span class="info-value" id="sellExchange">COMEX</span>
                </div>
                <div class="info-row">
                    <span class="info-label">REGIONAL PREMIUM</span>
                    <span class="info-value" id="sellPremium">+$50/MT</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Select Inventory</label>
                <select class="form-select" id="sellInventory">
                    <option value="none">-- No inventory available --</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Tonnage (MT)</label>
                <input type="number" class="form-input" id="sellTonnage" min="10" value="20">
                <div style="font-size: 11px; color: #888; margin-top: 6px;" id="sellRange">Range: 20 - 85 MT</div>
            </div>

            <div class="calc-section">
                <div class="calc-title">Revenue Breakdown (Estimated)</div>
                <div class="calc-row">
                    <span class="calc-label">Base Price (Spot):</span>
                    <span class="calc-value" id="sellBasePrice">$8960/MT</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">Regional Premium:</span>
                    <span class="calc-value" id="sellRegionalPremium">+$90/MT</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">Sale Price:</span>
                    <span class="calc-value" id="sellPricePerMT">$9050/MT</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">Total Revenue:</span>
                    <span class="calc-value" id="sellTotalRevenue">$181,000</span>
                </div>
                <div class="calc-row">
                    <span class="calc-label">Original Cost:</span>
                    <span class="calc-value" id="sellOriginalCost">$180,780</span>
                </div>
                <div class="calc-row total-row profit-row">
                    <span class="calc-label">Estimated Profit:</span>
                    <span class="calc-value" id="sellNetProfit">+$220</span>
                </div>
                <div class="warning-box">
                    ‚ö†Ô∏è <span id="sellQPWarning">QP settlement in March based on February average</span>
                </div>
            </div>

            <button class="execute-btn sell" id="executeSellBtn" onclick="window.TradePanel.executeSell()">SELL COPPER</button>
        </div>
    </div>

    <!-- Sale Details Modal (for Positions widget) -->
    <div id="saleDetailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: var(--bg-secondary); padding: 30px; border-radius: 12px; max-width: 500px; width: 90%; position: relative;">
            <button id="closeSaleDetailsBtn" style="position: absolute; top: 10px; right: 10px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-primary);">√ó</button>
            <h3 style="margin-bottom: 20px; color: var(--text-primary);">Sale Details</h3>
            <div id="saleDetailsContent"></div>
        </div>
    </div>
</body>
</html>
